<div class="container-fluid p-4">
  <div class="row mb-4">
    <div class="col-12">
      <h4 class="mb-0">افزودن تور جدید</h4>
      <p class="text-muted">اطلاعات تور جدید را وارد کنید</p>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="form-container">
        <form id="tourForm" #tourForm="ngForm" (ngSubmit)="SubmitForm(tourForm)">
          <!-- اطلاعات اصلی -->
          <div class="form-section">
            <h5 class="form-section-title">
              <i class="bi bi-info-circle"></i>
              اطلاعات اصلی تور
            </h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="tourName" class="form-label">عنوان تور</label>
                <input type="text" name="tourName" class="form-control" id="tourName"
                       [(ngModel)]="insertTourModel.Title" placeholder="عنوان تور را وارد کنید" required
                       #tourName="ngModel"
                       [minlength]="5">
                @if (formSubmitted && (tourName.invalid || tourName.dirty)) {
                  <div class="text-danger">
                    @if (tourName.errors?.['required']) {
                      <div>وارد کردن عنوان تور الزامی است.</div>
                    }
                    @if (tourName.errors?.['minlength']) {
                      <div>عنوان تور باید حداقل ۵ کاراکتر باشد.</div>
                    }
                  </div>
                }
              </div>
              <div class="col-md-3 mb-3">
                <label for="tourTypeSelect" class="form-label">نوع تور</label>
                <div class="management-select rel z-3">
                  <select class="select-nice TourType-cmb" name="tourTypeSelect">
                    @for (tourType of TourTypeSelect; track tourType.Guid) {
                      <option (click)="tourTypeSelectChange(tourType.Guid)" [value]="tourType.Guid"
                              [selected]="incomingTour.TourTypeGuid == tourType.Guid">{{ tourType.Name }}
                      </option>
                    }
                  </select>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="transportType" class="form-label">نوع حمل و نقل</label>
                <div class="management-select rel z-2">
                  <select class="select-nice TransportType-cmb" id="transportType"> required>
                    @for (transportType of TransportTypeSelect; track $index) {
                      <option [value]="transportType.Guid"
                              [selected]="incomingTour.TransportTypeGuid == transportType.Guid">{{ transportType.Name }}
                      </option>
                    }
                  </select>
                </div>
              </div>
              <!--              <div class="col-md-6 mb-3">-->
              <!--                <label for="tourDate" class="form-label">تاریخ برگزاری</label>-->
              <!--                <div class="datepicker-container">-->
              <!--                  <input type="text"-->
              <!--                         #dp1="appDatepicker"-->
              <!--                         [appDatepicker]="{ calendar: 'persian', locale: 'fa', rtl: true, theme:'dark' }"-->
              <!--                         class="form-control">-->
              <!--                </div>-->
              <!--              </div>-->
              <div class="col-12 mb-3">
                <label for="tourDescription" class="form-label">توضیحات تور</label>
                <textarea class="form-control" id="tourDescription" name="tourDescription" rows="3"
                          placeholder="توضیحات کامل درباره تور" [(ngModel)]="insertTourModel.Description"></textarea>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section-title">
              <i class="bi bi-geo-alt"></i>
              مبدا
            </h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="newsletter-form" style="background-color: #63AB45 !important;">
                  <input name="tourOrigin" class="tour-origin" [formControl]="originSearchControl" type="email"
                         placeholder="شهر/شهرستان مبدا" style="background-color: #63AB45 !important;" required>
                  <button type="button" [disabled]="true" (click)="SearchOriginLocationByName(originSearchControl)"
                          class="theme-btn bgc-secondary style-two">
                    <span data-hover="جستجو">جستجو</span>
                    <i class="fal fa-arrow-right"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label d-none d-md-block">&nbsp;</label>
                @if (originSearchResult == null || originSearchResult.length < 1) {

                  <span class="text-muted">چنان که مبدا مورد نظر در لیست وجود ندارد، ابتدا <a
                    class="link-offset-3 link-underline" style="text-decoration: underline !important;">از اینجا</a> اضافه کنید</span>
                }
              </div>
              <div class="col-md-6 mb-3">
                <ul class="nav nav product-tab mt-70 mb-30" data-aos="fade-up" data-aos-duration="1500"
                    data-aos-offset="50">
                  @for (result of originSearchResult; track result.Guid) {
                    <li><a (click)="insertTourModel.OriginGuid = result.Guid"
                           [class.active]="insertTourModel.OriginGuid == result.Guid">{{ result.LocationName }}<i
                      class="far fa-arrow-right"></i></a></li>
                  }
                </ul>
              </div>
              <!--              <div class="col-12 mb-3">-->
              <!--                <label for="tourAddress" class="form-label">آدرس دقیق</label>-->
              <!--                <textarea class="form-control" id="tourAddress" rows="2" placeholder="آدرس دقیق مبدا حرکت"></textarea>-->
              <!--              </div>-->
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section-title">
              <i class="bi bi-geo-alt"></i>
              مقصد نهایی
            </h5>
            <div class="row">
              <!--              <div class="col-md-6 mb-3">-->
              <!--                <label for="tourLocation" class="form-label">مکان</label>-->
              <!--                <input type="text" class="form-control" id="tourLocation" placeholder="مکان برگزاری تور" required>-->
              <!--              </div>-->
              <div class="col-md-6 mb-3">
                <div class="newsletter-form" style="background-color: #63AB45 !important;">
                  <input class="tour-destination" [formControl]="destinationSearchControl"
                         type="text" name="tourDestination" placeholder="شهر/شهرستان مقصد"
                         style="background-color: #63AB45 !important;"
                         required>
                  <button type="button" [disabled]="destinationSearchOnBind"
                          (click)="SearchDestLocationByName(destinationSearchControl)"
                          class="theme-btn bgc-secondary style-two">
                    <span data-hover="جستجو">جستجو</span>
                    <i class="fal fa-arrow-right"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label d-none d-md-block">&nbsp;</label>
                @if (destinationSearchResult == null || destinationSearchResult.length < 1) {
                  <span class="text-muted">چنان که مقصد مورد نظر در لیست وجود ندارد، ابتدا <a
                    class="link-offset-3 link-underline" style="text-decoration: underline !important;">از اینجا</a> اضافه کنید</span>
                }
              </div>

              <div class="col-md-6 mb-3">
                <ul class="nav nav product-tab mt-70 mb-30" data-aos="fade-up" data-aos-duration="1500"
                    data-aos-offset="50">
                  @for (result of destinationSearchResult; track result.Guid) {
                    <li><a (click)="insertTourModel.DestinationGuid = result.Guid"
                           [class.active]="insertTourModel.DestinationGuid == result.Guid">{{ result.LocationName }}<i
                      class="far fa-arrow-right"></i></a></li>
                  }
                </ul>
              </div>
              <!--              <div class="col-12 mb-3">-->
              <!--                <label for="tourAddress" class="form-label">آدرس دقیق مقصد</label>-->
              <!--                <textarea class="form-control" id="tourAddress" rows="2" placeholder="آدرس دقیق محل برگزاری"></textarea>-->
              <!--              </div>-->
            </div>
          </div>

          <!-- تصاویر -->
          <div class="form-section">
            <h5 class="form-section-title">
              <i class="bi bi-image"></i>
              تصاویر تور
            </h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="titleFile" class="form-label">تصویر تایتل تور</label>
                <input
                  class="form-control"
                  type="file"
                  name="titleFile"
                  id="titleFile"
                  (change)="onTitleFileChange($event)"
                  accept=".jpg,.jpeg,.png,.webp"
                />
              </div>
              @if (insertTourModel.TitleFile || (PageType == 2 && insertTourModel.ImageUrl != "" && insertTourModel.ImageUrl != null)) {
                <div class="mt-3">
                  <p class="mb-1">پیش‌نمایش تصویر:</p>
                  <img
                    [src]="GetImageSrc()"
                    alt="preview"
                    class="img-fluid rounded"
                    style="max-height: 200px;"
                  />
                </div>
              }
            </div>
          </div>

          <!-- قیمت و وضعیت -->
          <div class="form-section">
            <h5 class="form-section-title">
              <i class="bi bi-tag"></i>
              قیمت و وضعیت
            </h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="tourPrice" class="form-label">قیمت (تومان)</label>
                <input type="text" name="tourPrice" [(ngModel)]="insertTourModel.Price" persianCurrency
                       class="form-control" id="tourPrice" placeholder="قیمت به تومان" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="tourStatus" class="form-label">وضعیت تور</label>
                <div class="management-select rel z-3">
                  <select class="select-nice TourStatus-cmb" id="tourStatus" required>
                    <option (click)="insertTourModel.IsActive = true" [value]="true"
                            [selected]="insertTourModel.IsActive">فعال
                    </option>
                    <option (click)="insertTourModel.IsActive = false" [value]="false"
                            [selected]="!insertTourModel.IsActive">غیرفعال
                    </option>
                  </select>
                </div>
              </div>
              <!--              <div class="col-md-6 mb-3">-->
              <!--                <label for="tourCapacity" class="form-label">ظرفیت تور</label>-->
              <!--                <input type="number" name="tourCapacity" class="form-control" id="tourCapacity" min="1"-->
              <!--                       placeholder="حداکثر ظرفیت" required>-->
              <!--              </div>-->
            </div>
          </div>

          <!-- دکمه‌های فرم -->
          <div class="row mt-4">
            <div class="col-12 d-flex justify-content-center">
              @if (PageType == 2) {
                <button type="submit"
                        class="theme-btn bgc-secondary submit-action-button">
                  <span data-hover="ویرایش">ویرایش</span>
                  <i style="-webkit-transform: '' !important; transform: none !important;"
                     class="fal bi bi-pencil"></i>
                </button>
              } @else {

                <button type="submit"
                        class="theme-btn bgc-secondary submit-action-button">
                  <span data-hover="ثبت">ثبت</span>
                  <i style="-webkit-transform: '' !important; transform: none !important;"
                     class="fal bi bi-check-circle"></i>
                </button>
              }
              <button type="submit" [disabled]=""
                      (click)="SearchDestLocationByName(destinationSearchControl)"
                      class="theme-btn bgc-lighter style1-action-button">
                <span data-hover="بازگشت">بازگشت</span>
                <i style="-webkit-transform: '' !important; transform: none !important;" class="fal bi bi-x-circle"></i>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
